import{E as Re,Ra as Ee,Sa as _e,Ta as Te,fb as Ce}from"./chunk-654GDEVR.js";import{h as be,m as Ae,n as Se,o as Ue,s as Ie}from"./chunk-5TOTVD6K.js";import{Tb as te,Ub as re,a as X,b as W,cb as ke,cc as ve,ga as E,ha as Q,i as g,ib as q,ja as N,ka as x,la as me,o as de,pb as ge,pc as we,qb as ee,s as Z,sc as ne,t as fe,tc as ye,x as he,y as pe,z as j}from"./chunk-OSBU4Z27.js";function xe(l){if(!(this instanceof xe))throw new Error("The 'Keycloak' constructor must be invoked with 'new'.");if(typeof l!="string"&&!se(l))throw new Error("The 'Keycloak' constructor must be provided with a configuration object, or a URL to a JSON configuration file.");if(se(l)){let t="oidcProvider"in l?["clientId"]:["url","realm","clientId"];for(let r of t)if(!l[r])throw new Error(`The configuration object is missing the required '${r}' property.`)}var e=this,v,s=[],d,f={enable:!0,callbackList:[],interval:5};e.didInitialize=!1;var k=!0,A=le(console.info),S=le(console.warn);globalThis.isSecureContext||S(`[KEYCLOAK] Keycloak JS must be used in a 'secure context' to function properly as it relies on browser APIs that are otherwise not available.
Continuing to run your application insecurely will lead to unexpected behavior and breakage.

For more information see: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts`),e.init=function(t={}){if(e.didInitialize)throw new Error("A 'Keycloak' instance can only be initialized once.");e.didInitialize=!0,e.authenticated=!1,d=ze();var r=["default","cordova","cordova-native"];if(r.indexOf(t.adapter)>-1?v=$(t.adapter):typeof t.adapter=="object"?v=t.adapter:window.Cordova||window.cordova?v=$("cordova"):v=$(),typeof t.useNonce<"u"&&(k=t.useNonce),typeof t.checkLoginIframe<"u"&&(f.enable=t.checkLoginIframe),t.checkLoginIframeInterval&&(f.interval=t.checkLoginIframeInterval),t.onLoad==="login-required"&&(e.loginRequired=!0),t.responseMode)if(t.responseMode==="query"||t.responseMode==="fragment")e.responseMode=t.responseMode;else throw"Invalid value for responseMode";if(t.flow){switch(t.flow){case"standard":e.responseType="code";break;case"implicit":e.responseType="id_token token";break;case"hybrid":e.responseType="code id_token token";break;default:throw"Invalid value for flow"}e.flow=t.flow}if(t.timeSkew!=null&&(e.timeSkew=t.timeSkew),t.redirectUri&&(e.redirectUri=t.redirectUri),t.silentCheckSsoRedirectUri&&(e.silentCheckSsoRedirectUri=t.silentCheckSsoRedirectUri),typeof t.silentCheckSsoFallback=="boolean"?e.silentCheckSsoFallback=t.silentCheckSsoFallback:e.silentCheckSsoFallback=!0,typeof t.pkceMethod<"u"){if(t.pkceMethod!=="S256"&&t.pkceMethod!==!1)throw new TypeError(`Invalid value for pkceMethod', expected 'S256' or false but got ${t.pkceMethod}.`);e.pkceMethod=t.pkceMethod}else e.pkceMethod="S256";typeof t.enableLogging=="boolean"?e.enableLogging=t.enableLogging:e.enableLogging=!1,t.logoutMethod==="POST"?e.logoutMethod="POST":e.logoutMethod="GET",typeof t.scope=="string"&&(e.scope=t.scope),typeof t.acrValues=="string"&&(e.acrValues=t.acrValues),typeof t.messageReceiveTimeout=="number"&&t.messageReceiveTimeout>0?e.messageReceiveTimeout=t.messageReceiveTimeout:e.messageReceiveTimeout=1e4,e.responseMode||(e.responseMode="fragment"),e.responseType||(e.responseType="code",e.flow="standard");var c=y(),a=y();a.promise.then(function(){e.onReady&&e.onReady(e.authenticated),c.setSuccess(e.authenticated)}).catch(function(o){c.setError(o)});var i=je();function u(){var o=function(p){p||(m.prompt="none"),t.locale&&(m.locale=t.locale),e.login(m).then(function(){a.setSuccess()}).catch(function(w){a.setError(w)})},h=function(){return g(this,null,function*(){var p=document.createElement("iframe"),w=yield e.createLoginUrl({prompt:"none",redirectUri:e.silentCheckSsoRedirectUri});p.setAttribute("src",w),p.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),p.setAttribute("title","keycloak-silent-check-sso"),p.style.display="none",document.body.appendChild(p);var b=function(R){if(!(R.origin!==window.location.origin||p.contentWindow!==R.source)){var U=C(R.data);T(U,a),document.body.removeChild(p),window.removeEventListener("message",b)}};window.addEventListener("message",b)})},m={};switch(t.onLoad){case"check-sso":f.enable?V().then(function(){O().then(function(p){p?a.setSuccess():e.silentCheckSsoRedirectUri?h():o(!1)}).catch(function(p){a.setError(p)})}):e.silentCheckSsoRedirectUri?h():o(!1);break;case"login-required":o(!0);break;default:throw"Invalid value for onLoad"}}function n(){var o=C(window.location.href);if(o&&window.history.replaceState(window.history.state,null,o.newUrl),o&&o.valid)return V().then(function(){T(o,a)}).catch(function(h){a.setError(h)});t.token&&t.refreshToken?(L(t.token,t.refreshToken,t.idToken),f.enable?V().then(function(){O().then(function(h){h?(e.onAuthSuccess&&e.onAuthSuccess(),a.setSuccess(),K()):a.setSuccess()}).catch(function(h){a.setError(h)})}):e.updateToken(-1).then(function(){e.onAuthSuccess&&e.onAuthSuccess(),a.setSuccess()}).catch(function(h){e.onAuthError&&e.onAuthError(),t.onLoad?u():a.setError(h)})):t.onLoad?u():a.setSuccess()}return i.then(function(){He().then(n).catch(function(o){c.setError(o)})}),i.catch(function(o){c.setError(o)}),c.promise},e.login=function(t){return v.login(t)};function M(t){if(typeof crypto>"u"||typeof crypto.getRandomValues>"u")throw new Error("Web Crypto API is not available.");return crypto.getRandomValues(new Uint8Array(t))}function F(t){return B(t,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789")}function B(t,r){for(var c=M(t),a=new Array(t),i=0;i<t;i++)a[i]=r.charCodeAt(c[i]%r.length);return String.fromCharCode.apply(null,a)}function Me(t,r){return g(this,null,function*(){if(t!=="S256")throw new TypeError(`Invalid value for 'pkceMethod', expected 'S256' but got '${t}'.`);let c=new Uint8Array(yield Be(r));return Fe(c).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")})}function Le(t){var r={id_token:{acr:t}};return JSON.stringify(r)}e.createLoginUrl=function(t){return g(this,null,function*(){var r=ce(),c=ce(),a=v.redirectUri(t),i={state:r,nonce:c,redirectUri:encodeURIComponent(a),loginOptions:t};t&&t.prompt&&(i.prompt=t.prompt);var u;t&&t.action=="register"?u=e.endpoints.register():u=e.endpoints.authorize();var n=t&&t.scope||e.scope;n?n.indexOf("openid")===-1&&(n="openid "+n):n="openid";var o=u+"?client_id="+encodeURIComponent(e.clientId)+"&redirect_uri="+encodeURIComponent(a)+"&state="+encodeURIComponent(r)+"&response_mode="+encodeURIComponent(e.responseMode)+"&response_type="+encodeURIComponent(e.responseType)+"&scope="+encodeURIComponent(n);if(k&&(o=o+"&nonce="+encodeURIComponent(c)),t&&t.prompt&&(o+="&prompt="+encodeURIComponent(t.prompt)),t&&typeof t.maxAge=="number"&&(o+="&max_age="+encodeURIComponent(t.maxAge)),t&&t.loginHint&&(o+="&login_hint="+encodeURIComponent(t.loginHint)),t&&t.idpHint&&(o+="&kc_idp_hint="+encodeURIComponent(t.idpHint)),t&&t.action&&t.action!="register"&&(o+="&kc_action="+encodeURIComponent(t.action)),t&&t.locale&&(o+="&ui_locales="+encodeURIComponent(t.locale)),t&&t.acr){var h=Le(t.acr);o+="&claims="+encodeURIComponent(h)}if((t&&t.acrValues||e.acrValues)&&(o+="&acr_values="+encodeURIComponent(t.acrValues||e.acrValues)),e.pkceMethod)try{let m=F(96),p=yield Me(e.pkceMethod,m);i.pkceCodeVerifier=m,o+="&code_challenge="+p,o+="&code_challenge_method="+e.pkceMethod}catch(m){throw new Error("Failed to generate PKCE challenge.",{cause:m})}return d.add(i),o})},e.logout=function(t){return v.logout(t)},e.createLogoutUrl=function(t){if((t?.logoutMethod??e.logoutMethod)==="POST")return e.endpoints.logout();var c=e.endpoints.logout()+"?client_id="+encodeURIComponent(e.clientId)+"&post_logout_redirect_uri="+encodeURIComponent(v.redirectUri(t,!1));return e.idToken&&(c+="&id_token_hint="+encodeURIComponent(e.idToken)),c},e.register=function(t){return v.register(t)},e.createRegisterUrl=function(t){return g(this,null,function*(){return t||(t={}),t.action="register",yield e.createLoginUrl(t)})},e.createAccountUrl=function(t){var r=I(),c=void 0;return typeof r<"u"&&(c=r+"/account?referrer="+encodeURIComponent(e.clientId)+"&referrer_uri="+encodeURIComponent(v.redirectUri(t))),c},e.accountManagement=function(){return v.accountManagement()},e.hasRealmRole=function(t){var r=e.realmAccess;return!!r&&r.roles.indexOf(t)>=0},e.hasResourceRole=function(t,r){if(!e.resourceAccess)return!1;var c=e.resourceAccess[r||e.clientId];return!!c&&c.roles.indexOf(t)>=0},e.loadUserProfile=function(){var t=I()+"/account",r=new XMLHttpRequest;r.open("GET",t,!0),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Authorization","bearer "+e.token);var c=y();return r.onreadystatechange=function(){r.readyState==4&&(r.status==200?(e.profile=JSON.parse(r.responseText),c.setSuccess(e.profile)):c.setError())},r.send(),c.promise},e.loadUserInfo=function(){var t=e.endpoints.userinfo(),r=new XMLHttpRequest;r.open("GET",t,!0),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("Authorization","bearer "+e.token);var c=y();return r.onreadystatechange=function(){r.readyState==4&&(r.status==200?(e.userInfo=JSON.parse(r.responseText),c.setSuccess(e.userInfo)):c.setError())},r.send(),c.promise},e.isTokenExpired=function(t){if(!e.tokenParsed||!e.refreshToken&&e.flow!="implicit")throw"Not authenticated";if(e.timeSkew==null)return A("[KEYCLOAK] Unable to determine if token is expired as timeskew is not set"),!0;var r=e.tokenParsed.exp-Math.ceil(new Date().getTime()/1e3)+e.timeSkew;if(t){if(isNaN(t))throw"Invalid minValidity";r-=t}return r<0},e.updateToken=function(t){var r=y();if(!e.refreshToken)return r.setError(),r.promise;t=t||5;var c=function(){var i=!1;if(t==-1?(i=!0,A("[KEYCLOAK] Refreshing token: forced refresh")):(!e.tokenParsed||e.isTokenExpired(t))&&(i=!0,A("[KEYCLOAK] Refreshing token: token expired")),!i)r.setSuccess(!1);else{var u="grant_type=refresh_token&refresh_token="+e.refreshToken,n=e.endpoints.token();if(s.push(r),s.length==1){var o=new XMLHttpRequest;o.open("POST",n,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.withCredentials=!0,u+="&client_id="+encodeURIComponent(e.clientId);var h=new Date().getTime();o.onreadystatechange=function(){if(o.readyState==4)if(o.status==200){A("[KEYCLOAK] Token refreshed"),h=(h+new Date().getTime())/2;var m=JSON.parse(o.responseText);L(m.access_token,m.refresh_token,m.id_token,h),e.onAuthRefreshSuccess&&e.onAuthRefreshSuccess();for(var p=s.pop();p!=null;p=s.pop())p.setSuccess(!0)}else{S("[KEYCLOAK] Failed to refresh token"),o.status==400&&e.clearToken(),e.onAuthRefreshError&&e.onAuthRefreshError();for(var p=s.pop();p!=null;p=s.pop())p.setError("Failed to refresh token: An unexpected HTTP error occurred while attempting to refresh the token.")}},o.send(u)}}};if(f.enable){var a=O();a.then(function(){c()}).catch(function(i){r.setError(i)})}else c();return r.promise},e.clearToken=function(){e.token&&(L(null,null,null),e.onAuthLogout&&e.onAuthLogout(),e.loginRequired&&e.login())};function I(){if(typeof e.authServerUrl<"u")return e.authServerUrl.charAt(e.authServerUrl.length-1)=="/"?e.authServerUrl+"realms/"+encodeURIComponent(e.realm):e.authServerUrl+"/realms/"+encodeURIComponent(e.realm)}function Oe(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}function T(t,r){var c=t.code,a=t.error,i=t.prompt,u=new Date().getTime();if(t.kc_action_status&&e.onActionUpdate&&e.onActionUpdate(t.kc_action_status,t.kc_action),a){if(i!="none")if(t.error_description&&t.error_description==="authentication_expired")e.login(t.loginOptions);else{var n={error:a,error_description:t.error_description};e.onAuthError&&e.onAuthError(n),r&&r.setError(n)}else r&&r.setSuccess();return}else e.flow!="standard"&&(t.access_token||t.id_token)&&p(t.access_token,null,t.id_token,!0);if(e.flow!="implicit"&&c){var o="code="+c+"&grant_type=authorization_code",h=e.endpoints.token(),m=new XMLHttpRequest;m.open("POST",h,!0),m.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o+="&client_id="+encodeURIComponent(e.clientId),o+="&redirect_uri="+t.redirectUri,t.pkceCodeVerifier&&(o+="&code_verifier="+t.pkceCodeVerifier),m.withCredentials=!0,m.onreadystatechange=function(){if(m.readyState==4)if(m.status==200){var w=JSON.parse(m.responseText);p(w.access_token,w.refresh_token,w.id_token,e.flow==="standard"),K()}else e.onAuthError&&e.onAuthError(),r&&r.setError()},m.send(o)}function p(w,b,R,U){u=(u+new Date().getTime())/2,L(w,b,R,u),k&&e.idTokenParsed&&e.idTokenParsed.nonce!=t.storedNonce?(A("[KEYCLOAK] Invalid nonce, clearing token"),e.clearToken(),r&&r.setError()):U&&(e.onAuthSuccess&&e.onAuthSuccess(),r&&r.setSuccess())}}function je(){var t=y(),r;typeof l=="string"&&(r=l);function c(n){n?e.endpoints={authorize:function(){return n.authorization_endpoint},token:function(){return n.token_endpoint},logout:function(){if(!n.end_session_endpoint)throw"Not supported by the OIDC server";return n.end_session_endpoint},checkSessionIframe:function(){if(!n.check_session_iframe)throw"Not supported by the OIDC server";return n.check_session_iframe},register:function(){throw'Redirection to "Register user" page not supported in standard OIDC mode'},userinfo:function(){if(!n.userinfo_endpoint)throw"Not supported by the OIDC server";return n.userinfo_endpoint}}:e.endpoints={authorize:function(){return I()+"/protocol/openid-connect/auth"},token:function(){return I()+"/protocol/openid-connect/token"},logout:function(){return I()+"/protocol/openid-connect/logout"},checkSessionIframe:function(){return I()+"/protocol/openid-connect/login-status-iframe.html"},thirdPartyCookiesIframe:function(){return I()+"/protocol/openid-connect/3p-cookies/step1.html"},register:function(){return I()+"/protocol/openid-connect/registrations"},userinfo:function(){return I()+"/protocol/openid-connect/userinfo"}}}if(r){var a=new XMLHttpRequest;a.open("GET",r,!0),a.setRequestHeader("Accept","application/json"),a.onreadystatechange=function(){if(a.readyState==4)if(a.status==200||ae(a)){var n=JSON.parse(a.responseText);e.authServerUrl=n["auth-server-url"],e.realm=n.realm,e.clientId=n.resource,c(null),t.setSuccess()}else t.setError()},a.send()}else{e.clientId=l.clientId;var i=l.oidcProvider;if(!i)e.authServerUrl=l.url,e.realm=l.realm,c(null),t.setSuccess();else if(typeof i=="string"){var u;i.charAt(i.length-1)=="/"?u=i+".well-known/openid-configuration":u=i+"/.well-known/openid-configuration";var a=new XMLHttpRequest;a.open("GET",u,!0),a.setRequestHeader("Accept","application/json"),a.onreadystatechange=function(){if(a.readyState==4)if(a.status==200||ae(a)){var o=JSON.parse(a.responseText);c(o),t.setSuccess()}else t.setError()},a.send()}else c(i),t.setSuccess()}return t.promise}function ae(t){return t.status==0&&t.responseText&&t.responseURL.startsWith("file:")}function L(t,r,c,a){if(e.tokenTimeoutHandle&&(clearTimeout(e.tokenTimeoutHandle),e.tokenTimeoutHandle=null),r?(e.refreshToken=r,e.refreshTokenParsed=oe(r)):(delete e.refreshToken,delete e.refreshTokenParsed),c?(e.idToken=c,e.idTokenParsed=oe(c)):(delete e.idToken,delete e.idTokenParsed),t){if(e.token=t,e.tokenParsed=oe(t),e.sessionId=e.tokenParsed.sid,e.authenticated=!0,e.subject=e.tokenParsed.sub,e.realmAccess=e.tokenParsed.realm_access,e.resourceAccess=e.tokenParsed.resource_access,a&&(e.timeSkew=Math.floor(a/1e3)-e.tokenParsed.iat),e.timeSkew!=null&&(A("[KEYCLOAK] Estimated time difference between browser and server is "+e.timeSkew+" seconds"),e.onTokenExpired)){var i=(e.tokenParsed.exp-new Date().getTime()/1e3+e.timeSkew)*1e3;A("[KEYCLOAK] Token expires in "+Math.round(i/1e3)+" s"),i<=0?e.onTokenExpired():e.tokenTimeoutHandle=setTimeout(e.onTokenExpired,i)}}else delete e.token,delete e.tokenParsed,delete e.subject,delete e.realmAccess,delete e.resourceAccess,e.authenticated=!1}function ce(){if(typeof crypto>"u"||typeof crypto.randomUUID>"u")throw new Error("Web Crypto API is not available.");return crypto.randomUUID()}function C(t){var r=Ne(t);if(r){var c=d.get(r.state);return c&&(r.valid=!0,r.redirectUri=c.redirectUri,r.storedNonce=c.nonce,r.prompt=c.prompt,r.pkceCodeVerifier=c.pkceCodeVerifier,r.loginOptions=c.loginOptions),r}}function Ne(t){var r;switch(e.flow){case"standard":r=["code","state","session_state","kc_action_status","kc_action","iss"];break;case"implicit":r=["access_token","token_type","id_token","state","session_state","expires_in","kc_action_status","kc_action","iss"];break;case"hybrid":r=["access_token","token_type","id_token","code","state","session_state","expires_in","kc_action_status","kc_action","iss"];break}r.push("error"),r.push("error_description"),r.push("error_uri");var c=t.indexOf("?"),a=t.indexOf("#"),i,u;if(e.responseMode==="query"&&c!==-1?(i=t.substring(0,c),u=ue(t.substring(c+1,a!==-1?a:t.length),r),u.paramsString!==""&&(i+="?"+u.paramsString),a!==-1&&(i+=t.substring(a))):e.responseMode==="fragment"&&a!==-1&&(i=t.substring(0,a),u=ue(t.substring(a+1),r),u.paramsString!==""&&(i+="#"+u.paramsString)),u&&u.oauthParams){if(e.flow==="standard"||e.flow==="hybrid"){if((u.oauthParams.code||u.oauthParams.error)&&u.oauthParams.state)return u.oauthParams.newUrl=i,u.oauthParams}else if(e.flow==="implicit"&&(u.oauthParams.access_token||u.oauthParams.error)&&u.oauthParams.state)return u.oauthParams.newUrl=i,u.oauthParams}}function ue(t,r){for(var c=t.split("&"),a={paramsString:"",oauthParams:{}},i=0;i<c.length;i++){var u=c[i].indexOf("="),n=c[i].slice(0,u);r.indexOf(n)!==-1?a.oauthParams[n]=c[i].slice(u+1):(a.paramsString!==""&&(a.paramsString+="&"),a.paramsString+=c[i])}return a}function y(){var t={setSuccess:function(r){t.resolve(r)},setError:function(r){t.reject(r)}};return t.promise=new Promise(function(r,c){t.resolve=r,t.reject=c}),t}function De(t,r,c){var a=null,i=new Promise(function(u,n){a=setTimeout(function(){n({error:c||"Promise is not settled within timeout of "+r+"ms"})},r)});return Promise.race([t,i]).finally(function(){clearTimeout(a)})}function V(){var t=y();if(!f.enable||f.iframe)return t.setSuccess(),t.promise;var r=document.createElement("iframe");f.iframe=r,r.onload=function(){var i=e.endpoints.authorize();i.charAt(0)==="/"?f.iframeOrigin=Oe():f.iframeOrigin=i.substring(0,i.indexOf("/",8)),t.setSuccess()};var c=e.endpoints.checkSessionIframe();r.setAttribute("src",c),r.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),r.setAttribute("title","keycloak-session-iframe"),r.style.display="none",document.body.appendChild(r);var a=function(i){if(!(i.origin!==f.iframeOrigin||f.iframe.contentWindow!==i.source)&&(i.data=="unchanged"||i.data=="changed"||i.data=="error")){i.data!="unchanged"&&e.clearToken();for(var u=f.callbackList.splice(0,f.callbackList.length),n=u.length-1;n>=0;--n){var o=u[n];i.data=="error"?o.setError():o.setSuccess(i.data=="unchanged")}}};return window.addEventListener("message",a,!1),t.promise}function K(){f.enable&&e.token&&setTimeout(function(){O().then(function(t){t&&K()})},f.interval*1e3)}function O(){var t=y();if(f.iframe&&f.iframeOrigin){var r=e.clientId+" "+(e.sessionId?e.sessionId:"");f.callbackList.push(t);var c=f.iframeOrigin;f.callbackList.length==1&&f.iframe.contentWindow.postMessage(r,c)}else t.setSuccess();return t.promise}function He(){var t=y();if((f.enable||e.silentCheckSsoRedirectUri)&&typeof e.endpoints.thirdPartyCookiesIframe=="function"){var r=document.createElement("iframe");r.setAttribute("src",e.endpoints.thirdPartyCookiesIframe()),r.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),r.setAttribute("title","keycloak-3p-check-iframe"),r.style.display="none",document.body.appendChild(r);var c=function(a){r.contentWindow===a.source&&(a.data!=="supported"&&a.data!=="unsupported"||(a.data==="unsupported"&&(S(`[KEYCLOAK] Your browser is blocking access to 3rd-party cookies, this means:

 - It is not possible to retrieve tokens without redirecting to the Keycloak server (a.k.a. no support for silent authentication).
 - It is not possible to automatically detect changes to the session status (such as the user logging out in another tab).

For more information see: https://www.keycloak.org/securing-apps/javascript-adapter#_modern_browsers`),f.enable=!1,e.silentCheckSsoFallback&&(e.silentCheckSsoRedirectUri=!1)),document.body.removeChild(r),window.removeEventListener("message",c),t.setSuccess()))};window.addEventListener("message",c,!1)}else t.setSuccess();return De(t.promise,e.messageReceiveTimeout,"Timeout when waiting for 3rd party check iframe message.")}function $(t){if(!t||t=="default")return{login:function(n){return g(this,null,function*(){return window.location.assign(yield e.createLoginUrl(n)),y().promise})},logout:function(n){return g(this,null,function*(){if((n?.logoutMethod??e.logoutMethod)==="GET"){window.location.replace(e.createLogoutUrl(n));return}let h=document.createElement("form");h.setAttribute("method","POST"),h.setAttribute("action",e.createLogoutUrl(n)),h.style.display="none";let m={id_token_hint:e.idToken,client_id:e.clientId,post_logout_redirect_uri:v.redirectUri(n,!1)};for(let[p,w]of Object.entries(m)){let b=document.createElement("input");b.setAttribute("type","hidden"),b.setAttribute("name",p),b.setAttribute("value",w),h.appendChild(b)}document.body.appendChild(h),h.submit()})},register:function(n){return g(this,null,function*(){return window.location.assign(yield e.createRegisterUrl(n)),y().promise})},accountManagement:function(){var n=e.createAccountUrl();if(typeof n<"u")window.location.href=n;else throw"Not supported by the OIDC server";return y().promise},redirectUri:function(n,o){return arguments.length==1&&(o=!0),n&&n.redirectUri?n.redirectUri:e.redirectUri?e.redirectUri:location.href}};if(t=="cordova"){f.enable=!1;var r=function(n,o,h){return window.cordova&&window.cordova.InAppBrowser?window.cordova.InAppBrowser.open(n,o,h):window.open(n,o,h)},c=function(n){return n&&n.cordovaOptions?Object.keys(n.cordovaOptions).reduce(function(o,h){return o[h]=n.cordovaOptions[h],o},{}):{}},a=function(n){return Object.keys(n).reduce(function(o,h){return o.push(h+"="+n[h]),o},[]).join(",")},i=function(n){var o=c(n);return o.location="no",n&&n.prompt=="none"&&(o.hidden="yes"),a(o)},u=function(){return e.redirectUri||"http://localhost"};return{login:function(n){return g(this,null,function*(){var o=y(),h=i(n),m=yield e.createLoginUrl(n),p=r(m,"_blank",h),w=!1,b=!1,R=function(){b=!0,p.close()};return p.addEventListener("loadstart",function(U){if(U.url.indexOf(u())==0){var G=C(U.url);T(G,o),R(),w=!0}}),p.addEventListener("loaderror",function(U){if(!w)if(U.url.indexOf(u())==0){var G=C(U.url);T(G,o),R(),w=!0}else o.setError(),R()}),p.addEventListener("exit",function(U){b||o.setError({reason:"closed_by_user"})}),o.promise})},logout:function(n){var o=y(),h=e.createLogoutUrl(n),m=r(h,"_blank","location=no,hidden=yes,clearcache=yes"),p;return m.addEventListener("loadstart",function(w){w.url.indexOf(u())==0&&m.close()}),m.addEventListener("loaderror",function(w){w.url.indexOf(u())==0||(p=!0),m.close()}),m.addEventListener("exit",function(w){p?o.setError():(e.clearToken(),o.setSuccess())}),o.promise},register:function(n){return g(this,null,function*(){var o=y(),h=yield e.createRegisterUrl(),m=i(n),p=r(h,"_blank",m);return p.addEventListener("loadstart",function(w){if(w.url.indexOf(u())==0){p.close();var b=C(w.url);T(b,o)}}),o.promise})},accountManagement:function(){var n=e.createAccountUrl();if(typeof n<"u"){var o=r(n,"_blank","location=no");o.addEventListener("loadstart",function(h){h.url.indexOf(u())==0&&o.close()})}else throw"Not supported by the OIDC server"},redirectUri:function(n){return u()}}}if(t=="cordova-native")return f.enable=!1,{login:function(n){return g(this,null,function*(){var o=y(),h=yield e.createLoginUrl(n);return universalLinks.subscribe("keycloak",function(m){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close();var p=C(m.url);T(p,o)}),window.cordova.plugins.browsertab.openUrl(h),o.promise})},logout:function(n){var o=y(),h=e.createLogoutUrl(n);return universalLinks.subscribe("keycloak",function(m){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close(),e.clearToken(),o.setSuccess()}),window.cordova.plugins.browsertab.openUrl(h),o.promise},register:function(n){return g(this,null,function*(){var o=y(),h=yield e.createRegisterUrl(n);return universalLinks.subscribe("keycloak",function(m){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close();var p=C(m.url);T(p,o)}),window.cordova.plugins.browsertab.openUrl(h),o.promise})},accountManagement:function(){var n=e.createAccountUrl();if(typeof n<"u")window.cordova.plugins.browsertab.openUrl(n);else throw"Not supported by the OIDC server"},redirectUri:function(n){return n&&n.redirectUri?n.redirectUri:e.redirectUri?e.redirectUri:"http://localhost"}};throw"invalid adapter type: "+t}let P="kc-callback-";var J=function(){if(!(this instanceof J))return new J;localStorage.setItem("kc-test","test"),localStorage.removeItem("kc-test");var t=this;function r(){let u=Date.now();for(let[n,o]of a()){let h=i(o);(h===null||h<u)&&localStorage.removeItem(n)}}function c(){for(let[u]of a())localStorage.removeItem(u)}function a(){return Object.entries(localStorage).filter(([u])=>u.startsWith(P))}function i(u){let n;try{n=JSON.parse(u)}catch{return null}return se(n)&&"expires"in n&&typeof n.expires=="number"?n.expires:null}t.get=function(u){if(u){var n=P+u,o=localStorage.getItem(n);return o&&(localStorage.removeItem(n),o=JSON.parse(o)),r(),o}},t.add=function(u){r();let n=P+u.state,o=JSON.stringify(W(X({},u),{expires:Date.now()+3600*1e3}));try{localStorage.setItem(n,o)}catch{c(),localStorage.setItem(n,o)}}},Y=function(){if(!(this instanceof Y))return new Y;var t=this;t.get=function(i){if(i){var u=c(P+i);if(a(P+i,"",r(-100)),u)return JSON.parse(u)}},t.add=function(i){a(P+i.state,JSON.stringify(i),r(60))},t.removeItem=function(i){a(i,"",r(-100))};var r=function(i){var u=new Date;return u.setTime(u.getTime()+i*60*1e3),u},c=function(i){for(var u=i+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var h=n[o];h.charAt(0)==" ";)h=h.substring(1);if(h.indexOf(u)==0)return h.substring(u.length,h.length)}return""},a=function(i,u,n){var o=i+"="+u+"; expires="+n.toUTCString()+"; ";document.cookie=o}};function ze(){try{return new J}catch{}return new Y}function le(t){return function(){e.enableLogging&&t.apply(console,Array.prototype.slice.call(arguments))}}}var Pe=xe;function Fe(l){let e=String.fromCodePoint(...l);return btoa(e)}function Be(l){return g(this,null,function*(){let v=new TextEncoder().encode(l);if(typeof crypto>"u"||typeof crypto.subtle>"u")throw new Error("Web Crypto API is not available.");return yield crypto.subtle.digest("SHA-256",v)})}function oe(l){let[e,v]=l.split(".");if(typeof v!="string")throw new Error("Unable to decode token, payload not found.");let s;try{s=Ve(v)}catch(d){throw new Error("Unable to decode token, payload is not a valid Base64URL value.",{cause:d})}try{return JSON.parse(s)}catch(d){throw new Error("Unable to decode token, payload is not a valid JSON value.",{cause:d})}}function Ve(l){let e=l.replaceAll("-","+").replaceAll("_","/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("Input is not of the correct length.")}try{return Ke(e)}catch{return atob(e)}}function Ke(l){return decodeURIComponent(atob(l).replace(/(.)/g,(e,v)=>{let s=v.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}function se(l){return typeof l=="object"&&l!==null}var _=(function(l){return l[l.OnAuthError=0]="OnAuthError",l[l.OnAuthLogout=1]="OnAuthLogout",l[l.OnAuthRefreshError=2]="OnAuthRefreshError",l[l.OnAuthRefreshSuccess=3]="OnAuthRefreshSuccess",l[l.OnAuthSuccess=4]="OnAuthSuccess",l[l.OnReady=5]="OnReady",l[l.OnTokenExpired=6]="OnTokenExpired",l[l.OnActionUpdate=7]="OnActionUpdate",l})(_||{});var D=class{constructor(e,v){this.router=e,this.keycloakAngular=v}canActivate(e,v){return g(this,null,function*(){try{return this.authenticated=yield this.keycloakAngular.isLoggedIn(),this.roles=yield this.keycloakAngular.getUserRoles(!0),yield this.isAccessAllowed(e,v)}catch(s){throw new Error("An error happened during access validation. Details:"+s)}})}};var z=(()=>{let e=class e{constructor(){this._keycloakEvents$=new de}bindsKeycloakEvents(){this._instance.onAuthError=s=>{this._keycloakEvents$.next({args:s,type:_.OnAuthError})},this._instance.onAuthLogout=()=>{this._keycloakEvents$.next({type:_.OnAuthLogout})},this._instance.onAuthRefreshSuccess=()=>{this._keycloakEvents$.next({type:_.OnAuthRefreshSuccess})},this._instance.onAuthRefreshError=()=>{this._keycloakEvents$.next({type:_.OnAuthRefreshError})},this._instance.onAuthSuccess=()=>{this._keycloakEvents$.next({type:_.OnAuthSuccess})},this._instance.onTokenExpired=()=>{this._keycloakEvents$.next({type:_.OnTokenExpired})},this._instance.onActionUpdate=s=>{this._keycloakEvents$.next({args:s,type:_.OnActionUpdate})},this._instance.onReady=s=>{this._keycloakEvents$.next({args:s,type:_.OnReady})}}loadExcludedUrls(s){let d=[];for(let f of s){let k;typeof f=="string"?k={urlPattern:new RegExp(f,"i"),httpMethods:[]}:k={urlPattern:new RegExp(f.url,"i"),httpMethods:f.httpMethods},d.push(k)}return d}initServiceValues({enableBearerInterceptor:s=!0,loadUserProfileAtStartUp:d=!1,bearerExcludedUrls:f=[],authorizationHeaderName:k="Authorization",bearerPrefix:A="Bearer",initOptions:S,updateMinValidity:M=20,shouldAddToken:F=()=>!0,shouldUpdateToken:B=()=>!0}){this._enableBearerInterceptor=s,this._loadUserProfileAtStartUp=d,this._authorizationHeaderName=k,this._bearerPrefix=A.trim().concat(" "),this._excludedUrls=this.loadExcludedUrls(f),this._silentRefresh=S?S.flow==="implicit":!1,this._updateMinValidity=M,this.shouldAddToken=F,this.shouldUpdateToken=B}init(){return g(this,arguments,function*(s={}){this.initServiceValues(s);let{config:d,initOptions:f}=s;this._instance=new Pe(d),this.bindsKeycloakEvents();let k=yield this._instance.init(f);return k&&this._loadUserProfileAtStartUp&&(yield this.loadUserProfile()),k})}login(){return g(this,arguments,function*(s={}){yield this._instance.login(s),this._loadUserProfileAtStartUp&&(yield this.loadUserProfile())})}logout(s){return g(this,null,function*(){let d={redirectUri:s};yield this._instance.logout(d),this._userProfile=void 0})}register(){return g(this,arguments,function*(s={action:"register"}){yield this._instance.register(s)})}isUserInRole(s,d){let f;return f=this._instance.hasResourceRole(s,d),f||(f=this._instance.hasRealmRole(s)),f}getUserRoles(s=!0,d){let f=[];if(this._instance.resourceAccess&&Object.keys(this._instance.resourceAccess).forEach(k=>{if(d&&d!==k)return;let S=this._instance.resourceAccess[k].roles||[];f=f.concat(S)}),s&&this._instance.realmAccess){let k=this._instance.realmAccess.roles||[];f.push(...k)}return f}isLoggedIn(){return this._instance?this._instance.authenticated:!1}isTokenExpired(s=0){return this._instance.isTokenExpired(s)}updateToken(){return g(this,arguments,function*(s=this._updateMinValidity){if(this._silentRefresh){if(this.isTokenExpired())throw new Error("Failed to refresh the token, or the session is expired");return!0}if(!this._instance)throw new Error("Keycloak Angular library is not initialized.");try{return yield this._instance.updateToken(s)}catch{return!1}})}loadUserProfile(s=!1){return g(this,null,function*(){if(this._userProfile&&!s)return this._userProfile;if(!this._instance.authenticated)throw new Error("The user profile was not loaded as the user is not logged in.");return this._userProfile=yield this._instance.loadUserProfile()})}getToken(){return g(this,null,function*(){return this._instance.token})}getUsername(){if(!this._userProfile)throw new Error("User not logged in or user profile was not loaded.");return this._userProfile.username}clearToken(){this._instance.clearToken()}addTokenToHeader(s=new Ae){return Z(this.getToken()).pipe(he(d=>d?s.set(this._authorizationHeaderName,this._bearerPrefix+d):s))}getKeycloakInstance(){return this._instance}get excludedUrls(){return this._excludedUrls}get enableBearerInterceptor(){return this._enableBearerInterceptor}get keycloakEvents$(){return this._keycloakEvents$}};e.\u0275fac=function(d){return new(d||e)},e.\u0275prov=E({token:e,factory:e.\u0275fac});let l=e;return l})();var $e=(()=>{let e=class e{constructor(){this.keycloak=me(z)}conditionallyUpdateToken(s){return g(this,null,function*(){return this.keycloak.shouldUpdateToken(s)?yield this.keycloak.updateToken():!0})}isUrlExcluded({method:s,url:d},{urlPattern:f,httpMethods:k}){let A=k.length===0||k.join().indexOf(s.toUpperCase())>-1,S=f.test(d);return A&&S}intercept(s,d){let{enableBearerInterceptor:f,excludedUrls:k}=this.keycloak;return!f||!this.keycloak.shouldAddToken(s)||k.findIndex(S=>this.isUrlExcluded(s,S))>-1?d.handle(s):pe([Z(this.conditionallyUpdateToken(s)),fe(this.keycloak.isLoggedIn())]).pipe(j(([S,M])=>M?this.handleRequestWithTokenHeader(s,d):d.handle(s)))}handleRequestWithTokenHeader(s,d){return this.keycloak.addTokenToHeader(s.headers).pipe(j(f=>{let k=s.clone({headers:f});return d.handle(k)}))}};e.\u0275fac=function(d){return new(d||e)},e.\u0275prov=E({token:e,factory:e.\u0275fac});let l=e;return l})();var Je=(()=>{let e=class e{};e.\u0275fac=function(d){return new(d||e)},e.\u0275mod=ee({type:e}),e.\u0275inj=Q({providers:[z,{provide:Ue,useClass:$e,multi:!0}],imports:[be]});let l=e;return l})();var St=(()=>{let e=class e{};e.\u0275fac=function(d){return new(d||e)},e.\u0275mod=ee({type:e}),e.\u0275inj=Q({imports:[Je]});let l=e;return l})();var Ut=new N("Keycloak Events Signal");var It=new N("Include the bearer token as implemented by the provided function");var Rt=new N("Include the bearer token when explicitly defined int the URL pattern condition");var Ct=(()=>{let e=class e extends D{constructor(s,d){super(s,d),this.router=s,this.keycloak=d}isAccessAllowed(s,d){return g(this,null,function*(){if(console.log("AuthGuard isAccessAllowed called"),!this.authenticated)return!1;let f=s.data.roles;return!(f instanceof Array)||f.length===0||f.every(k=>this.roles.includes(k))?!0:(this.router.navigate(["access-denied"]),!1)})}};e.\u0275fac=function(d){return new(d||e)(x(Ie),x(z))},e.\u0275prov=E({token:e,factory:e.\u0275fac,providedIn:"root"});let l=e;return l})();var ie=(()=>{let e=class e{constructor(s,d){this.snackBarRef=s,this.data=d}close(){this.snackBarRef.dismiss()}};e.\u0275fac=function(d){return new(d||e)(q(Ee),q(_e))},e.\u0275cmp=ge({type:e,selectors:[["app-message"]],standalone:!1,decls:5,vars:3,consts:[[1,"message-container"],["mat-button","",3,"click"]],template:function(d,f){d&1&&(te(0,"div",0)(1,"span"),ne(2),re(),te(3,"button",1),ve("click",function(){return f.close()}),ne(4,"\u2716"),re()()),d&2&&(we("background",f.data.background),ke(2),ye(f.data.message))},dependencies:[Re],styles:[".message-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;color:#fff;padding:16px;border-radius:4px;width:100%}button[_ngcontent-%COMP%]{color:#fff;border:none;background:transparent;cursor:pointer}"]});let l=e;return l})();var Nt=(()=>{let e=class e{constructor(s){this.snackBar=s}showMessage(s,d=3e3){this.snackBar.openFromComponent(ie,{data:{message:s,background:"rgb(58, 159, 92)"},duration:d,panelClass:["custom-snackbar"]})}showErrorMessage(s){this.snackBar.openFromComponent(ie,{data:{message:s,background:"rgb(224, 51, 51)"},duration:5e3,verticalPosition:"bottom",horizontalPosition:"center"})}};e.\u0275fac=function(d){return new(d||e)(x(Te))},e.\u0275prov=E({token:e,factory:e.\u0275fac,providedIn:"root"});let l=e;return l})();var Ft=(()=>{let e=class e extends Ce{constructor(s){super(s),this.setBaseUrl("user")}changePassword(s){return this.http.post(`${this.baseUrl}/change-password/`,s)}};e.\u0275fac=function(d){return new(d||e)(x(Se))},e.\u0275prov=E({token:e,factory:e.\u0275fac,providedIn:"root"});let l=e;return l})();export{z as a,St as b,Ct as c,Ft as d,ie as e,Nt as f};
